function toggleTheme() { const html = document.documentElement; const currentTheme = html.getAttribute('data-theme'); const newTheme = currentTheme === 'dark' ? 'light' : 'dark'; html.setAttribute('data-theme', newTheme); localStorage.setItem('theme', newTheme); document.getElementById('theme-icon').textContent = newTheme === 'dark' ? 'ðŸŒ™' : 'â˜€ï¸';}const savedTheme = localStorage.getItem('theme') || 'dark';document.documentElement.setAttribute('data-theme', savedTheme);document.getElementById('theme-icon').textContent = savedTheme === 'dark' ? 'ðŸŒ™' : 'â˜€ï¸';const revealElements = document.querySelectorAll('.scroll-reveal');if ('IntersectionObserver' in window) { const revealObserver = new IntersectionObserver((entries) => { entries.forEach(entry => { if (entry.isIntersecting) { entry.target.classList.add('revealed'); revealObserver.unobserve(entry.target); } }); }, { threshold: 0.1, rootMargin: '0px 0px -100px 0px' }); revealElements.forEach(el => revealObserver.observe(el));} else { const revealOnScroll = () => { revealElements.forEach(el => { const rect = el.getBoundingClientRect(); if (rect.top < window.innerHeight - 100) { el.classList.add('revealed'); } }); }; window.addEventListener('scroll', revealOnScroll, { passive: true }); revealOnScroll();}function getCurrentBlogLanguage() { const savedLang = localStorage.getItem('blog_language_preference'); if (savedLang) return savedLang; const userLang = (navigator.language || navigator.userLanguage).toLowerCase(); const isItalian = userLang.startsWith('it'); return isItalian ? 'it' : 'en';}function toggleBlogLanguage() { const currentLang = getCurrentBlogLanguage(); const newLang = currentLang === 'it' ? 'en' : 'it'; localStorage.setItem('blog_language_preference', newLang); updateLanguageToggleUI(newLang); loadLatestBlogPosts(newLang);}function updateLanguageToggleUI(lang) { const icon = document.getElementById('lang-icon'); const text = document.getElementById('lang-text'); if (lang === 'it') { icon.textContent = 'ðŸ‡®ðŸ‡¹'; text.textContent = 'IT'; } else { icon.textContent = 'ðŸ‡¬ðŸ‡§'; text.textContent = 'EN'; }}async function loadLatestBlogPosts(forceLang = null) { const lang = forceLang || getCurrentBlogLanguage(); updateLanguageToggleUI(lang); const cacheKey = `blog_posts_${lang}_` + new Date().toDateString(); const cached = localStorage.getItem(cacheKey); if (cached) { try { const posts = JSON.parse(cached); renderBlogPosts(posts, lang); return; } catch (e) { console.warn('Failed to parse cached blog posts:', e); localStorage.removeItem(cacheKey); } } try { const blogJsonPath = lang === 'en' ? '/AndreaBozzo/blog/en/index.json' : '/AndreaBozzo/blog/index.json'; const response = await fetch(blogJsonPath); if (!response.ok) { throw new Error('Failed to fetch blog posts'); } const posts = await response.json(); localStorage.setItem(cacheKey, JSON.stringify(posts)); renderBlogPosts(posts, lang); } catch (error) { console.error('Failed to load blog posts:', error); showBlogError(lang); }}function renderBlogPosts(posts, lang) { const blogGrid = document.getElementById('blog-grid'); if (!blogGrid || !posts || posts.length === 0) { showBlogError(lang); return; } const latestPosts = posts.slice(0, 2); blogGrid.innerHTML = latestPosts.map(post => { const date = formatBlogDate(post.date || '', lang); const tags = extractTags(post); return ` <a href="${post.permalink}" class="blog-card" style="text-decoration: none; color: inherit;"> <div class="blog-date">${escapeHtml(date)}</div> <div class="blog-title">${escapeHtml(post.title)}</div> <div class="blog-summary">${escapeHtml(post.summary)}</div> <div class="blog-tags"> ${tags.map(tag => `<span class="blog-tag">${escapeHtml(tag)}</span>`).join('')} </div> </a> `; }).join('');}function showBlogError(lang) { const blogGrid = document.getElementById('blog-grid'); const message = lang === 'it' ? 'Nessun articolo disponibile al momento.' : 'No articles available at the moment.'; blogGrid.innerHTML = ` <div class="blog-card" style="text-align: center; padding: 3rem;"> <div class="blog-title">${message}</div> </div> `;}function formatBlogDate(dateString, lang) { if (!dateString) return lang === 'it' ? 'Recente' : 'Recent'; try { const date = new Date(dateString); const options = { year: 'numeric', month: 'long', day: 'numeric' }; const locale = lang === 'it' ? 'it-IT' : 'en-US'; return date.toLocaleDateString(locale, options); } catch (e) { return dateString; }}function extractTags(post) { if (post.tags && Array.isArray(post.tags)) { return post.tags.slice(0, 4); } const defaultTags = []; const content = (post.content || post.title || '').toLowerCase(); if (content.includes('rust')) defaultTags.push('Rust'); if (content.includes('data') && content.includes('engineer')) defaultTags.push('Data Engineering'); if (content.includes('streaming')) defaultTags.push('Streaming'); if (content.includes('iceberg')) defaultTags.push('Apache Iceberg'); return defaultTags.slice(0, 4);}function escapeHtml(text) { const map = { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;' }; return text.replace(/[&<>"']/g, m => map[m]);}if ('serviceWorker' in navigator && window.location.hostname !== 'localhost') { window.addEventListener('load', () => { navigator.serviceWorker.register('/AndreaBozzo/sw.js') .then((registration) => { console.log('âœ… Service Worker registered:', registration.scope); setInterval(() => { registration.update(); }, 60 * 60 * 1000); }) .catch((error) => { console.log('âŒ Service Worker registration failed:', error); }); navigator.serviceWorker.addEventListener('controllerchange', () => { console.log('ðŸ”„ Service Worker updated, reloading...'); window.location.reload(); }); });}document.addEventListener('DOMContentLoaded', function() { const loadBlogPosts = () => loadLatestBlogPosts(); if ('requestIdleCallback' in window) { requestIdleCallback(loadBlogPosts); } else { setTimeout(loadBlogPosts, 100); }});